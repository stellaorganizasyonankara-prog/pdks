<!doctype html>
<html lang="tr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next Level PDKS | Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        .card-inner { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .bg-main { background-color: #020617; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 24px 24px; }
        .tab-active { border-bottom: 4px solid #10b981; color: #10b981; }
        #reader { width: 100% !important; border: none !important; border-radius: 2rem; overflow: hidden; }
        video { border-radius: 2rem; }
    </style>
</head>
<body class="h-full bg-slate-50 font-sans">

    <div id="login-screen" class="h-full bg-main flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <div class="text-center mb-8">
                <h1 class="text-5xl font-black text-white italic tracking-tighter">NEXT LEVEL</h1>
                <p class="text-emerald-400 font-bold text-[10px] uppercase tracking-[0.3em] mt-2">Giri≈ü Sistemi v1.0</p>
            </div>
            <div class="bg-white/5 backdrop-blur-2xl p-8 rounded-[2.5rem] border border-white/10 shadow-2xl">
                <form id="gate-form" class="space-y-4" onsubmit="handleLogin(event)">
                    <input type="text" id="access-id" placeholder="8 HANELƒ∞ ID" maxlength="8" required class="w-full p-5 rounded-2xl bg-black/40 text-white text-center text-2xl font-mono border border-white/5 outline-none focus:border-emerald-500 transition-all">
                    <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-black py-5 rounded-2xl shadow-xl uppercase tracking-widest transition-all">Sisteme Giri≈ü</button>
                </form>
                <div class="mt-8 flex justify-between border-t border-white/5 pt-6">
                    <button onclick="tryAuth('admin')" class="text-slate-500 hover:text-emerald-400 text-[10px] font-black uppercase">‚öôÔ∏è Y√∂netici</button>
                    <button onclick="tryAuth('security')" class="text-slate-500 hover:text-emerald-400 text-[10px] font-black uppercase">üõ°Ô∏è G√ºvenlik</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dynamic-content" class="hidden min-h-full flex flex-col"></div>

    <script>
        // VERƒ∞TABANI ƒ∞SMƒ∞Nƒ∞ G√úNCELLEDƒ∞K - TEMƒ∞Z Bƒ∞R BA≈ûLANGI√á
        const DB_NAME = 'next_level_final_db';
        const LOG_NAME = 'next_level_final_logs';

        let db = JSON.parse(localStorage.getItem(DB_NAME)) || [];
        let logs = JSON.parse(localStorage.getItem(LOG_NAME)) || [];
        let isScanning = false;

        // --- Gƒ∞Rƒ∞≈û MANTIƒûI ---
        function handleLogin(e) {
            e.preventDefault();
            const inputId = document.getElementById('access-id').value.trim();
            // G√ºncel DB'den kontrol et
            const currentDb = JSON.parse(localStorage.getItem(DB_NAME)) || [];
            const person = currentDb.find(u => u.id === inputId);

            if (person) {
                if(person.durum === 'pasif') alert("KAYIT PASƒ∞F! Y√∂neticiye ba≈üvurun.");
                else renderPersonelView(person);
            } else {
                alert("Kullanƒ±cƒ± Bulunamadƒ±! (Girdiƒüiniz ID: " + inputId + ")");
            }
        }

        // --- Y√ñNETƒ∞Cƒ∞ PANELƒ∞ ---
        function renderAdminView() {
            document.getElementById('login-screen').style.display = 'none';
            const dynamic = document.getElementById('dynamic-content');
            dynamic.classList.remove('hidden');
            
            dynamic.innerHTML = `
                <div class="bg-white border-b shadow-sm sticky top-0 z-50">
                    <div class="max-w-7xl mx-auto px-6 flex justify-between items-center h-20">
                        <div class="flex space-x-6 h-full">
                            <button onclick="switchTab('list')" id="tab-list" class="font-black text-[11px] uppercase tracking-widest h-full px-2">üë• Personeller</button>
                            <button onclick="switchTab('add')" id="tab-add" class="font-black text-[11px] uppercase tracking-widest h-full px-2">‚ûï Yeni Kayƒ±t</button>
                            <button onclick="switchTab('logs')" id="tab-logs" class="font-black text-[11px] uppercase tracking-widest h-full px-2">üìù Giri≈üler</button>
                        </div>
                        <button onclick="location.reload()" class="bg-red-50 text-red-600 px-4 py-2 rounded-xl text-[10px] font-black uppercase">√áƒ±kƒ±≈ü</button>
                    </div>
                </div>
                <div id="tab-content" class="max-w-7xl mx-auto p-6 flex-1"></div>
            `;
            switchTab('list');
        }

        function switchTab(tab) {
            const content = document.getElementById('tab-content');
            // Tab renklerini g√ºncelle
            ['list', 'add', 'logs'].forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                el.className = t === tab ? "font-black text-[11px] uppercase tracking-widest h-full px-2 tab-active" : "font-black text-[11px] uppercase tracking-widest h-full px-2 text-slate-400";
            });

            if(tab === 'list') {
                const currentDb = JSON.parse(localStorage.getItem(DB_NAME)) || [];
                content.innerHTML = `
                    <div class="bg-white rounded-[2rem] border shadow-sm overflow-hidden animate-pop">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b text-[10px] font-black text-slate-400 uppercase">
                                <tr><th class="p-6">Foto</th><th class="p-6">ƒ∞sim</th><th class="p-6">ID</th><th class="p-6 text-right">Durum</th></tr>
                            </thead>
                            <tbody class="divide-y">
                                ${currentDb.length === 0 ? '<tr><td colspan="4" class="p-10 text-center text-slate-400">Hen√ºz personel yok.</td></tr>' : 
                                currentDb.map(u => `
                                    <tr>
                                        <td class="p-4"><img src="${u.foto}" class="w-12 h-12 rounded-xl object-cover border"></td>
                                        <td class="p-4 font-black uppercase text-sm">${u.ad} ${u.soyad}</td>
                                        <td class="p-4 font-mono font-bold text-emerald-600">${u.id}</td>
                                        <td class="p-4 text-right">
                                            <button onclick="toggleUserStatus('${u.id}')" class="px-4 py-2 rounded-lg text-[10px] font-black uppercase ${u.durum==='aktif'?'bg-red-50 text-red-600':'bg-emerald-50 text-emerald-600'}">
                                                ${u.durum==='aktif'?'PASƒ∞F YAP':'AKTƒ∞F YAP'}
                                            </button>
                                        </td>
                                    </tr>
                                `).reverse().join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            if(tab === 'add') {
                content.innerHTML = `
                    <div class="max-w-md mx-auto bg-white p-8 rounded-[2.5rem] border shadow-sm animate-pop">
                        <form onsubmit="saveUser(event)" class="space-y-4">
                            <div class="flex flex-col items-center mb-4">
                                <div id="preview" class="w-24 h-24 bg-slate-50 rounded-2xl mb-2 border-2 border-dashed flex items-center justify-center text-[10px] font-bold text-slate-300">FOTOƒûRAF</div>
                                <input type="file" id="f-foto" accept="image/*" required class="text-xs">
                            </div>
                            <input type="text" id="f-ad" placeholder="AD" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" required>
                            <input type="text" id="f-soyad" placeholder="SOYAD" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" required>
                            <input type="text" id="f-magaza" placeholder="MAƒûAZA" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" required>
                            <button type="submit" id="save-btn" class="w-full bg-slate-900 text-white font-black py-4 rounded-2xl uppercase">KAYDET</button>
                        </form>
                    </div>
                `;
                document.getElementById('f-foto').onchange = function(e) {
                    const reader = new FileReader();
                    reader.onload = () => document.getElementById('preview').innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover rounded-2xl">`;
                    reader.readAsDataURL(e.target.files[0]);
                };
            }

            if(tab === 'logs') {
                const currentLogs = JSON.parse(localStorage.getItem(LOG_NAME)) || [];
                content.innerHTML = `<div class="bg-white p-8 rounded-[2rem] border shadow-sm space-y-2">
                    ${currentLogs.map(l => `<div class="flex justify-between p-3 bg-slate-50 rounded-xl border text-xs font-mono"><b>${l.isim}</b> <span>${l.tarih} ${l.saat}</span></div>`).reverse().join('')}
                </div>`;
            }
        }

        function saveUser(e) {
            e.preventDefault();
            const btn = document.getElementById('save-btn');
            btn.disabled = true; // √áoklu basƒ±mƒ± √∂nle
            
            const reader = new FileReader();
            const file = document.getElementById('f-foto').files[0];
            
            reader.onload = function() {
                const newUser = {
                    id: Math.floor(10000000 + Math.random() * 90000000).toString(),
                    ad: document.getElementById('f-ad').value,
                    soyad: document.getElementById('f-soyad').value,
                    magaza: document.getElementById('f-magaza').value,
                    foto: reader.result,
                    durum: 'aktif'
                };
                
                let currentDb = JSON.parse(localStorage.getItem(DB_NAME)) || [];
                currentDb.push(newUser);
                localStorage.setItem(DB_NAME, JSON.stringify(currentDb));
                
                alert("Kayƒ±t Ba≈üarƒ±lƒ±! ID: " + newUser.id);
                switchTab('list');
            };
            reader.readAsDataURL(file);
        }

        function toggleUserStatus(id) {
            let currentDb = JSON.parse(localStorage.getItem(DB_NAME)) || [];
            const idx = currentDb.findIndex(u => u.id === id);
            currentDb[idx].durum = currentDb[idx].durum === 'aktif' ? 'pasif' : 'aktif';
            localStorage.setItem(DB_NAME, JSON.stringify(currentDb));
            switchTab('list');
        }

        // --- G√úVENLƒ∞K VE PERSONEL G√ñR√úN√úM√ú ---
        function renderPersonelView(user) {
            document.getElementById('login-screen').style.display = 'none';
            const dynamic = document.getElementById('dynamic-content');
            dynamic.classList.remove('hidden');
            dynamic.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen bg-slate-900 p-6">
                    <div class="w-full max-w-sm bg-slate-800 p-8 rounded-[3rem] text-white border border-white/10">
                        <img src="${user.foto}" class="w-24 h-24 rounded-2xl mb-6 object-cover border-2 border-emerald-500">
                        <h2 class="text-3xl font-black uppercase italic">${user.ad} ${user.soyad}</h2>
                        <p class="text-emerald-400 font-bold text-xs uppercase mb-8">${user.magaza}</p>
                        <div class="flex justify-between items-center border-t border-white/10 pt-6">
                            <span class="font-mono text-xl">${user.id}</span>
                            <div id="qr" class="bg-white p-1 rounded-lg"></div>
                        </div>
                    </div>
                    <button onclick="location.reload()" class="mt-8 text-slate-500 font-bold uppercase text-xs tracking-widest">√áIKI≈û YAP</button>
                </div>
            `;
            new QRCode(document.getElementById("qr"), { text: user.id, width: 80, height: 80 });
        }

        function renderSecurityView() {
            document.getElementById('login-screen').style.display = 'none';
            const dynamic = document.getElementById('dynamic-content');
            dynamic.classList.remove('hidden');
            dynamic.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen p-4">
                    <div class="bg-white p-8 rounded-[3rem] shadow-2xl w-full max-w-lg text-center">
                        <h2 class="text-xl font-black mb-6 italic">üõ°Ô∏è G√úVENLƒ∞K TARAMA</h2>
                        <div id="reader" class="bg-black shadow-inner"></div>
                        <div id="res" class="hidden mt-6 p-6 rounded-3xl text-white"></div>
                        <button onclick="location.reload()" class="mt-8 text-slate-300 font-bold text-xs">KAPAT</button>
                    </div>
                </div>
            `;
            const scanner = new Html5Qrcode("reader");
            scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (id) => {
                if(isScanning) return;
                isScanning = true;
                
                const currentDb = JSON.parse(localStorage.getItem(DB_NAME)) || [];
                const found = currentDb.find(u => u.id === id);
                const res = document.getElementById('res');
                document.getElementById('reader').style.display = 'none';
                res.classList.remove('hidden');

                if(found && found.durum === 'aktif') {
                    res.className = "mt-6 p-6 rounded-3xl text-white bg-emerald-500 animate-pop";
                    res.innerHTML = `<img src="${found.foto}" class="w-20 h-20 rounded-xl mx-auto mb-2 object-cover border-2 border-white">
                                     <h3 class="font-black">Gƒ∞Rƒ∞≈û ONAYLANDI</h3><p>${found.ad} ${found.soyad}</p>`;
                    
                    let currentLogs = JSON.parse(localStorage.getItem(LOG_NAME)) || [];
                    currentLogs.push({isim: found.ad+" "+found.soyad, tarih: new Date().toLocaleDateString('tr-TR'), saat: new Date().toLocaleTimeString('tr-TR')});
                    localStorage.setItem(LOG_NAME, JSON.stringify(currentLogs));
                } else {
                    res.className = "mt-6 p-6 rounded-3xl text-white bg-red-500 animate-pop";
                    res.innerHTML = `<h3 class="font-black">GE√áERSƒ∞Z VEYA PASƒ∞F</h3>`;
                }

                setTimeout(() => {
                    isScanning = false;
                    res.classList.add('hidden');
                    document.getElementById('reader').style.display = 'block';
                }, 3000);
            });
        }

        function tryAuth(type) {
            const p = prompt("≈ûifre:");
            if(type==='admin' && p==='1234') renderAdminView();
            else if(type==='security' && p==='123456') renderSecurityView();
            else if(p !== null) alert("Hatalƒ±!");
        }
    </script>
</body>
</html>
